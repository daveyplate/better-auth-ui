{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "magic-link",
  "type": "registry:component",
  "title": "Magic Link",
  "description": "A magic link sign-in form component with email input and optional social provider support.",
  "dependencies": [
    "@better-auth-ui/react@workspace:*",
    "better-auth",
    "lucide-react"
  ],
  "registryDependencies": [
    "button",
    "card",
    "input",
    "field",
    "separator",
    "sonner",
    "spinner"
  ],
  "files": [
    {
      "path": "src/components/auth/magic-link.tsx",
      "content": "\"use client\"\n\nimport type { AnyAuthConfig } from \"@better-auth-ui/react\"\nimport { useState } from \"react\"\n\nimport { Button } from \"@/components/ui/button\"\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\"\nimport {\n  Field,\n  FieldDescription,\n  FieldError,\n  FieldGroup,\n  FieldLabel,\n  FieldSeparator\n} from \"@/components/ui/field\"\nimport { Input } from \"@/components/ui/input\"\nimport { Spinner } from \"@/components/ui/spinner\"\nimport { useAuth } from \"@/hooks/auth/use-auth\"\nimport { useSignInMagicLink } from \"@/hooks/auth/use-sign-in-magic-link\"\nimport { useSignInSocial } from \"@/hooks/auth/use-sign-in-social\"\nimport { cn } from \"@/lib/utils\"\nimport { MagicLinkButton } from \"./magic-link-button\"\nimport { ProviderButtons, type SocialLayout } from \"./provider-buttons\"\n\nexport type MagicLinkProps = AnyAuthConfig & {\n  className?: string\n  socialLayout?: SocialLayout\n  socialPosition?: \"top\" | \"bottom\"\n}\n\n/**\n * Render a card-based sign-in form that sends an email magic link and optionally shows social provider buttons.\n */\nexport function MagicLink({\n  className,\n  socialLayout,\n  socialPosition = \"bottom\",\n  ...config\n}: MagicLinkProps) {\n  const context = useAuth(config)\n\n  const {\n    basePaths,\n    localization,\n    magicLink,\n    socialProviders,\n    viewPaths,\n    Link\n  } = context\n\n  const [{ email }, signInMagicLink, magicLinkPending] =\n    useSignInMagicLink(context)\n\n  const [_, signInSocial, socialPending] = useSignInSocial(context)\n\n  const isPending = magicLinkPending || socialPending\n\n  const [fieldErrors, setFieldErrors] = useState<{\n    email?: string\n  }>({})\n\n  const showSeparator = socialProviders && socialProviders.length > 0\n\n  return (\n    <Card className={cn(\"w-full max-w-sm py-4 md:py-6\", className)}>\n      <CardHeader className=\"px-4 md:px-6 -mb-4\">\n        <CardTitle className=\"text-xl\">{localization.auth.signIn}</CardTitle>\n      </CardHeader>\n\n      <CardContent className=\"px-4 md:px-6\">\n        <FieldGroup className=\"gap-4\">\n          {socialPosition === \"top\" && (\n            <>\n              {socialProviders && socialProviders.length > 0 && (\n                <ProviderButtons\n                  {...config}\n                  socialLayout={socialLayout}\n                  signInSocial={signInSocial}\n                  isPending={isPending}\n                />\n              )}\n\n              {showSeparator && (\n                <FieldSeparator className=\"*:data-[slot=field-separator-content]:bg-card m-0 text-xs flex items-center\">\n                  {localization.auth.or}\n                </FieldSeparator>\n              )}\n            </>\n          )}\n\n          <form action={signInMagicLink}>\n            <FieldGroup className=\"gap-4\">\n              <Field className=\"gap-1\">\n                <FieldLabel htmlFor=\"email\">\n                  {localization.auth.email}\n                </FieldLabel>\n\n                <Input\n                  id=\"email\"\n                  name=\"email\"\n                  type=\"email\"\n                  autoComplete=\"email\"\n                  defaultValue={email}\n                  placeholder={localization.auth.emailPlaceholder}\n                  required\n                  disabled={isPending}\n                  onChange={() => {\n                    setFieldErrors((prev) => ({\n                      ...prev,\n                      email: undefined\n                    }))\n                  }}\n                  onInvalid={(e) => {\n                    e.preventDefault()\n                    setFieldErrors((prev) => ({\n                      ...prev,\n                      email: (e.target as HTMLInputElement).validationMessage\n                    }))\n                  }}\n                  aria-invalid={!!fieldErrors.email}\n                />\n\n                <FieldError>{fieldErrors.email}</FieldError>\n              </Field>\n\n              <Field className=\"mt-1\">\n                <Button type=\"submit\" disabled={isPending} className=\"w-full\">\n                  {isPending && <Spinner />}\n\n                  {localization.auth.sendMagicLink}\n                </Button>\n\n                {magicLink && (\n                  <MagicLinkButton\n                    {...config}\n                    view=\"magicLink\"\n                    isPending={isPending}\n                  />\n                )}\n              </Field>\n            </FieldGroup>\n          </form>\n\n          {socialPosition === \"bottom\" && (\n            <>\n              {showSeparator && (\n                <FieldSeparator className=\"*:data-[slot=field-separator-content]:bg-card m-0 text-xs flex items-center\">\n                  {localization.auth.or}\n                </FieldSeparator>\n              )}\n\n              {socialProviders && socialProviders.length > 0 && (\n                <ProviderButtons\n                  {...config}\n                  socialLayout={socialLayout}\n                  signInSocial={signInSocial}\n                  isPending={isPending}\n                />\n              )}\n            </>\n          )}\n\n          <FieldDescription className=\"flex justify-center gap-1\">\n            {localization.auth.needToCreateAnAccount}\n\n            <Link\n              href={`${basePaths.auth}/${viewPaths.auth.signUp}`}\n              className=\"underline underline-offset-4\"\n            >\n              {localization.auth.signUp}\n            </Link>\n          </FieldDescription>\n        </FieldGroup>\n      </CardContent>\n    </Card>\n  )\n}\n",
      "type": "registry:component"
    },
    {
      "path": "src/components/auth/magic-link-button.tsx",
      "content": "\"use client\"\n\nimport type { AnyAuthConfig } from \"@better-auth-ui/react\"\nimport type { AuthView } from \"@better-auth-ui/react/core\"\nimport { Lock, Mail } from \"lucide-react\"\n\nimport { Button } from \"@/components/ui/button\"\nimport { useAuth } from \"@/hooks/auth/use-auth\"\n\nexport type MagicLinkButtonProps = AnyAuthConfig & {\n  isPending: boolean\n  view?: AuthView\n}\n\n/**\n * A button that links to either the magic-link or sign-in route and displays the corresponding icon and label.\n *\n * @param isPending - If true, apply disabled styling and prevent interactions\n * @param view - Current auth view; when `\"magicLink\"`, the button shows the password/sign-in variant\n */\nexport function MagicLinkButton({\n  isPending,\n  view,\n  ...config\n}: MagicLinkButtonProps) {\n  const { basePaths, viewPaths, localization, Link } = useAuth(config)\n\n  const isMagicLinkView = view === \"magicLink\"\n\n  return (\n    <Button\n      type=\"button\"\n      variant=\"outline\"\n      className=\"w-full\"\n      disabled={isPending}\n      asChild\n    >\n      <Link\n        href={`${basePaths.auth}/${isMagicLinkView ? viewPaths.auth.signIn : viewPaths.auth.magicLink}`}\n      >\n        {isMagicLinkView ? <Lock /> : <Mail />}\n\n        {localization.auth.continueWith.replace(\n          \"{{provider}}\",\n          isMagicLinkView\n            ? localization.auth.password\n            : localization.auth.magicLink\n        )}\n      </Link>\n    </Button>\n  )\n}\n",
      "type": "registry:component"
    },
    {
      "path": "src/components/auth/provider-buttons.tsx",
      "content": "\"use client\"\n\nimport type { AnyAuthConfig } from \"@better-auth-ui/react\"\nimport { providerIcons } from \"@better-auth-ui/react\"\nimport { getProviderName } from \"@better-auth-ui/react/core\"\nimport { useMemo } from \"react\"\n\nimport { Button } from \"@/components/ui/button\"\nimport { Field } from \"@/components/ui/field\"\nimport { useAuth } from \"@/hooks/auth/use-auth\"\nimport { cn } from \"@/lib/utils\"\n\nexport type ProviderButtonsProps = AnyAuthConfig & {\n  isPending: boolean\n  socialLayout?: SocialLayout\n  signInSocial: (formData: FormData) => void\n}\n\nexport type SocialLayout = \"auto\" | \"horizontal\" | \"vertical\" | \"grid\"\n\n/**\n * Render social provider sign-in buttons and handle sign-in initiation and pending state.\n *\n * @param isPending - When true, disables all provider buttons.\n * @param socialLayout - Preferred layout for the provider buttons; when set to `\"auto\"` the layout is chosen based on the number of available providers.\n * @param signInSocial - The function to call when a social provider button is clicked.\n */\nexport function ProviderButtons({\n  isPending,\n  socialLayout = \"auto\",\n  signInSocial,\n  ...config\n}: ProviderButtonsProps) {\n  const { localization, socialProviders } = useAuth(config)\n\n  const resolvedSocialLayout = useMemo(() => {\n    if (socialLayout === \"auto\") {\n      if (socialProviders?.length && socialProviders.length >= 4) {\n        return \"horizontal\"\n      }\n\n      return \"vertical\"\n    }\n\n    return socialLayout\n  }, [socialLayout, socialProviders?.length])\n\n  return (\n    <form action={signInSocial}>\n      <Field\n        className={cn(\n          \"gap-3\",\n          resolvedSocialLayout === \"grid\" && \"grid grid-cols-2\",\n          resolvedSocialLayout === \"vertical\" && \"flex-col\",\n          resolvedSocialLayout === \"horizontal\" && \"flex-row flex-wrap\"\n        )}\n      >\n        {socialProviders?.map((provider) => {\n          const ProviderIcon = providerIcons[provider]\n\n          return (\n            <Button\n              key={provider}\n              name=\"provider\"\n              value={provider}\n              className={cn(\n                \"flex-1\",\n                resolvedSocialLayout === \"horizontal\" && \"flex-1\"\n              )}\n              variant=\"outline\"\n              type=\"submit\"\n              disabled={isPending}\n            >\n              <ProviderIcon />\n\n              {resolvedSocialLayout === \"vertical\"\n                ? localization.auth.continueWith.replace(\n                    \"{{provider}}\",\n                    getProviderName(provider)\n                  )\n                : resolvedSocialLayout === \"grid\"\n                  ? getProviderName(provider)\n                  : null}\n            </Button>\n          )\n        })}\n      </Field>\n    </form>\n  )\n}\n",
      "type": "registry:component"
    },
    {
      "path": "src/hooks/auth/use-auth.tsx",
      "content": "import {\n  type AnyAuthConfig,\n  type AuthConfig,\n  AuthContext\n} from \"@better-auth-ui/react\"\nimport { deepmerge, defaultConfig } from \"@better-auth-ui/react/core\"\nimport { useContext } from \"react\"\nimport { toast } from \"sonner\"\n\nconst extendConfig: AnyAuthConfig = {\n  toast,\n  Link: (props) => <a {...props} />\n}\n\n/**\n * Constructs the effective AuthConfig by merging defaults, any AuthContext-provided config, and the optional `config` overrides.\n *\n * @param config - Partial configuration overrides applied on top of context and defaults\n * @returns The final `AuthConfig` with a non-optional `authClient`\n * @throws If the resulting config does not include an `authClient`\n */\nexport function useAuth(config?: AnyAuthConfig) {\n  const context = useContext(AuthContext)\n\n  const authConfig = deepmerge(\n    deepmerge(defaultConfig as AnyAuthConfig, extendConfig),\n    deepmerge(context || {}, config || {})\n  ) as AuthConfig\n\n  if (authConfig.authClient === undefined) {\n    throw new Error(\"[Better Auth UI] authClient is required\")\n  }\n\n  return authConfig\n}\n",
      "type": "registry:hook"
    },
    {
      "path": "../react/src/hooks/auth/use-sign-in-magic-link.ts",
      "content": "import { type AnyAuthConfig, useRedirectTo } from \"@better-auth-ui/react\"\nimport { useActionState } from \"react\"\n\nimport { useAuth } from \"./use-auth\"\n\nexport function useSignInMagicLink(config?: AnyAuthConfig) {\n  const { authClient, baseURL, localization, toast } = useAuth(config)\n  const redirectTo = useRedirectTo(config)\n\n  const signInMagicLink = async (_: object, formData: FormData) => {\n    const email = formData.get(\"email\") as string\n\n    const callbackURL = `${baseURL}${redirectTo}`\n\n    const { error } = await authClient.signIn.magicLink({\n      email,\n      callbackURL\n    })\n\n    if (error) {\n      toast.error(error.message || error.statusText)\n\n      return { email }\n    }\n\n    toast.success(localization.auth.magicLinkSent)\n\n    return { email: \"\" }\n  }\n\n  return useActionState(signInMagicLink, { email: \"\" })\n}\n",
      "type": "registry:hook"
    },
    {
      "path": "../react/src/hooks/auth/use-sign-in-social.ts",
      "content": "import { type AnyAuthConfig, useRedirectTo } from \"@better-auth-ui/react\"\nimport { useActionState } from \"react\"\n\nimport { useAuth } from \"./use-auth\"\n\nexport function useSignInSocial(config?: AnyAuthConfig) {\n  const { authClient, baseURL, toast } = useAuth(config)\n  const redirectTo = useRedirectTo(config)\n\n  const signInSocial = async (_: object, formData: FormData) => {\n    const provider = formData.get(\"provider\") as string\n\n    const callbackURL = `${baseURL}${redirectTo}`\n\n    const { error } = await authClient.signIn.social({\n      provider,\n      callbackURL\n    })\n\n    if (error) toast.error(error.message || error.statusText)\n\n    return { provider }\n  }\n\n  return useActionState(signInSocial, { provider: \"\" })\n}\n",
      "type": "registry:hook"
    }
  ]
}
