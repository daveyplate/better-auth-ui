{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "use-auth",
  "type": "registry:component",
  "title": "useAuth Hook",
  "description": "Hook for accessing authentication configuration and client.",
  "files": [
    {
      "path": "../react/src/hooks/use-auth.tsx",
      "content": "\"use client\"\n\nimport { basePaths, viewPaths } from \"@better-auth-ui/core\"\nimport type { DeepPartial } from \"better-auth/react\"\nimport deepmerge from \"deepmerge\"\nimport { useContext } from \"react\"\n\nimport type { AuthConfig } from \"../components/auth-provider\"\nimport { AuthContext } from \"../components/auth-provider\"\nimport { useHydrated } from \"./use-hydrated\"\n\nconst defaultConfig = {\n  basePaths,\n  baseURL: \"\",\n  emailAndPassword: {\n    enabled: true,\n    forgotPassword: true,\n    rememberMe: false\n  },\n  redirectTo: \"/\",\n  viewPaths,\n  navigate: (path: string) => {\n    window.location.href = path\n  },\n  replace: (path: string) => window.location.replace(path),\n  Link: (props) => <a {...props} />\n} satisfies Omit<AuthConfig, \"authClient\">\n\n/**\n * Constructs the effective AuthConfig by merging defaults, any AuthContext-provided config, and the optional `config` overrides.\n *\n * Merges default configuration, any AuthContext-provided config, and the optional `config` argument (with latter values taking precedence). When the app is hydrated, a `redirectTo` query parameter is read and — if it decodes to a relative path that starts with `/`, does not start with `//`, does not contain a scheme (`://`), and does not contain backslashes — it overrides the resulting `redirectTo` value to prevent open-redirects.\n *\n * @param config - Partial configuration overrides applied on top of context and defaults\n * @returns The final `AuthConfig` with a non-optional `authClient`\n * @throws If the resulting config does not include an `authClient`\n */\nexport function useAuth(config?: DeepPartial<AuthConfig>) {\n  const context = useContext(AuthContext)\n  const hydrated = useHydrated()\n\n  const authConfig = deepmerge(\n    defaultConfig,\n    deepmerge(context || {}, config || {})\n  )\n\n  if (authConfig.authClient === undefined) {\n    throw new Error(\"[Better Auth UI] authClient is required\")\n  }\n\n  // Validate redirectTo from URL search params to prevent open redirect vulnerabilities\n  if (hydrated) {\n    const redirectToParam = new URLSearchParams(window.location.search).get(\n      \"redirectTo\"\n    )\n\n    if (redirectToParam) {\n      const redirectTo = redirectToParam.trim()\n\n      // Validate: must be a relative path starting with \"/\" but not \"//\"\n      // and must not contain a scheme (e.g., \"://\") or backslashes\n      // (browsers can normalize \"\\\" to \"/\" making \"/\\evil.com\" become \"//evil.com\")\n      const isValidRedirect =\n        redirectTo.startsWith(\"/\") &&\n        !redirectTo.startsWith(\"//\") &&\n        !redirectTo.includes(\"://\") &&\n        !redirectTo.includes(\"\\\\\")\n\n      if (isValidRedirect) {\n        authConfig.redirectTo = redirectTo\n      }\n    }\n  }\n\n  return authConfig as AuthConfig\n}\n",
      "type": "registry:component"
    }
  ]
}